<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
    <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8" />
    <TITLE>ASCOM autoFilterWheel Driver - Read Me</TITLE>
    <STYLE TYPE="text/css">
        body {
            font-family: "Segoe UI", "Verdana", "Arial", sans-serif;
            margin: 20px;
            line-height: 1.6;
            color: #333;
        }

        h1 {
            color: #0066cc;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
        }

        h2 {
            color: #0066cc;
            margin-top: 30px;
        }

        h3 {
            color: #333;
            margin-top: 20px;
        }

        .note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }

        .info {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
        }

        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }

        li {
            margin: 5px 0;
        }

        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "Consolas", "Courier New", monospace;
            color: #c7254e;
        }

        .screenshot {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 20px 0;
            text-align: center;
            background-color: #f9f9f9;
        }

        .screenshot img {
            max-width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        a {
            color: #0066cc;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }

        table td, table th {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        table th {
            background-color: #0066cc;
            color: white;
        }

        table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </STYLE>
</HEAD>
<BODY>
    <H1>ASCOM autoFilterWheel Driver</H1>
    <P><strong>Version 2.0</strong> - ESP32-C3 Based Filter Wheel Controller</P>

    <H2>Description</H2>
    <P>
        The <strong>autoFilterWheel</strong> is an ASCOM-compliant filter wheel driver designed to control an ESP32-C3 based motorized filter wheel.
        This driver enables seamless integration with popular astronomy software such as NINA (N.I.N.A.), TheSky, MaxIm DL, and any other ASCOM-compatible applications.
    </P>

    <P>
        The system uses a 28BYJ-48 stepper motor with ULN2003 driver and features:
    </P>
    <UL>
        <LI><strong>Configurable filter slots:</strong> Supports 3 to 9 filter positions</LI>
        <LI><strong>AS5600 magnetic encoder:</strong> Provides precise angular position feedback and automatic calibration</LI>
        <LI><strong>OLED Display:</strong> Real-time status display showing current filter position and system information</LI>
        <LI><strong>Serial communication:</strong> USB connection via ESP32-C3 with 115200 baud rate</LI>
        <LI><strong>Customizable filter names:</strong> Name each filter position for easy identification</LI>
        <LI><strong>Motor configuration:</strong> Adjustable speed, acceleration, and disable delay settings</LI>
    </UL>

    <div class="info">
        <strong>Firmware Repository:</strong> The ESP32-C3 firmware source code is available at:<br/>
        <a href="https://github.com/juanjol/autoFilterWheel" target="_blank">https://github.com/juanjol/autoFilterWheel</a>
    </div>

    <H2>Hardware Requirements</H2>
    <UL>
        <LI>ESP32-C3 microcontroller (SUPERMINI variant recommended)</LI>
        <LI>28BYJ-48 5V Stepper Motor</LI>
        <LI>ULN2003 Motor Driver Board</LI>
        <LI>AS5600 Magnetic Rotary Encoder (optional but recommended)</LI>
        <LI>SSD1306 128x64 OLED Display (optional)</LI>
        <LI>USB cable for connection to PC</LI>
    </UL>

    <H2>Installation</H2>
    <OL>
        <LI><strong>Install ASCOM Platform:</strong> Download and install the latest ASCOM Platform from <a href="https://ascom-standards.org/" target="_blank">https://ascom-standards.org/</a></LI>
        <LI><strong>Flash the Firmware:</strong> Upload the firmware to your ESP32-C3 using PlatformIO or Arduino IDE (see firmware repository for instructions)</LI>
        <LI><strong>Install the Driver:</strong> Run the installer executable (<code>autoFilterWheelSetup.exe</code>) which will register the driver with ASCOM</LI>
        <LI><strong>Connect Hardware:</strong> Connect the ESP32-C3 to your PC via USB</LI>
    </OL>

    <div class="note">
        <strong>Note:</strong> The driver installer requires administrator privileges to register the COM components properly.
    </div>

    <H2>Configuration</H2>
    <P>Access the driver configuration dialog through your ASCOM client application (e.g., NINA, TheSky) or via the ASCOM Diagnostics tool.</P>

    <H3>Connection Setup</H3>
    <OL>
        <LI>Select the COM port from the dropdown menu</LI>
        <LI>Click the <strong>refresh (↻)</strong> button to update available COM ports</LI>
        <LI>Click <strong>"Set port & close"</strong> to save and exit, or use <strong>"Connect"</strong> to test the connection</LI>
        <LI>Use <strong>"Disconnect"</strong> to close the serial connection when done</LI>
    </OL>

    <H3>Filter Configuration</H3>
    <P>Configure the number of filters and assign custom names to each position:</P>
    <OL>
        <LI><strong>Filter Count:</strong> Select between 3 and 9 filters from the dropdown</LI>
        <LI><strong>Filter Names:</strong> Enter descriptive names (up to 15 characters) for each filter position
            <UL>
                <LI>Filters are organized in 3 columns for easy viewing</LI>
                <LI>Examples: "Luminance", "Red", "Green", "Blue", "Ha", "OIII", "SII"</LI>
            </UL>
        </LI>
        <LI><strong>Reload Filter Names:</strong> Click this button to retrieve current filter names from the device</LI>
        <LI><strong>Save Configuration:</strong> Click to send filter names and count to the device and save to EEPROM</LI>
        <LI><strong>Select Filter:</strong> Use the dropdown to manually move the wheel to a specific filter position</LI>
    </OL>

    <div class="screenshot">
        <h4>Driver Setup Dialog</h4>
        <img src="screenshot.png" alt="Driver setup dialog showing filter configuration" />
        <p><em>Setup dialog showing connection controls at the top and filter configuration with customizable names organized in 3 columns</em></p>
    </div>

    <H3>Motor Configuration</H3>
    <P>Fine-tune motor behavior for optimal performance:</P>
    <TABLE>
        <TR>
            <TH>Parameter</TH>
            <TH>Range</TH>
            <TH>Description</TH>
        </TR>
        <TR>
            <TD>Motor Speed</TD>
            <TD>50-3000 steps/s</TD>
            <TD>Operating speed for filter changes</TD>
        </TR>
        <TR>
            <TD>Max Speed</TD>
            <TD>100-5000 steps/s</TD>
            <TD>Maximum allowed motor speed</TD>
        </TR>
        <TR>
            <TD>Acceleration</TD>
            <TD>50-2000 steps/s²</TD>
            <TD>Rate of speed increase/decrease</TD>
        </TR>
        <TR>
            <TD>Disable Delay</TD>
            <TD>500-10000 ms</TD>
            <TD>Time motor stays powered after movement</TD>
        </TR>
        <TR>
            <TD>Steps/Revolution</TD>
            <TD>Custom</TD>
            <TD>Total steps for one complete rotation (default: 2048 for 28BYJ-48)</TD>
        </TR>
    </TABLE>

    <H3>Calibration</H3>
    <P>Manual calibration controls for precise positioning:</P>
    <UL>
        <LI><strong>Move Backward/Forward:</strong> Manually adjust wheel position in steps (1, 5, 10, 20, 50, 100, 200)</LI>
        <LI><strong>Set to Pos 1:</strong> Calibrate the current position as filter position #1</LI>
    </UL>

    <div class="note">
        <strong>Important:</strong> If using an AS5600 encoder, calibration is automatic. The manual calibration controls are primarily for systems without an encoder or for fine-tuning.
    </div>

    <H2>Usage Instructions</H2>

    <H3>First Time Setup</H3>
    <OL>
        <LI>Launch your ASCOM client application (e.g., NINA)</LI>
        <LI>Open the Filter Wheel equipment selector and choose <strong>"ASCOM autoFilterWheel"</strong></LI>
        <LI>Click <strong>Settings</strong> or <strong>Setup</strong> to open the driver configuration</LI>
        <LI>Select your COM port and click <strong>"Connect"</strong></LI>
        <LI>Configure filter count and names, then click <strong>"Save Configuration"</strong></LI>
        <LI>If needed, perform manual calibration using <strong>"Set to Pos 1"</strong></LI>
        <LI>Test filter movement using the <strong>"Select Filter"</strong> dropdown</LI>
    </OL>

    <H3>Normal Operation</H3>
    <P>Once configured, the filter wheel integrates seamlessly with your imaging workflow:</P>
    <UL>
        <LI>Your ASCOM client will automatically connect to the filter wheel</LI>
        <LI>Filter changes are requested by the client application during sequences</LI>
        <LI>The driver handles movement commands and tracks position automatically</LI>
        <LI>The OLED display (if equipped) shows real-time position and status</LI>
        <LI>Filter names configured in the driver appear in your client application</LI>
    </UL>

    <H3>Troubleshooting</H3>

    <H4>Filter wheel not responding in NINA or other clients</H4>
    <UL>
        <LI>Verify the ESP32-C3 is connected and the correct COM port is selected</LI>
        <LI>Check that firmware version 2.0+ is installed on the ESP32-C3</LI>
        <LI>Ensure no other application is using the COM port</LI>
        <LI>Try clicking <strong>"Disconnect"</strong> then <strong>"Connect"</strong> in the setup dialog</LI>
        <LI>Check ASCOM logs in <code>Documents\ASCOM\Logs yyyy-mm-dd</code> folder</LI>
    </UL>

    <H4>COM port not appearing in list</H4>
    <UL>
        <LI>Install CP210x or CH340 USB driver if required by your ESP32-C3 board</LI>
        <LI>Click the <strong>refresh (↻)</strong> button to update the port list</LI>
        <LI>Check Device Manager to verify the ESP32 is recognized</LI>
        <LI>Try a different USB cable or port</LI>
    </UL>

    <H4>Position errors or inconsistent movement</H4>
    <UL>
        <LI>Recalibrate using <strong>"Set to Pos 1"</strong> when the wheel is at position 1</LI>
        <LI>If using AS5600 encoder, verify magnet alignment and sensor distance (2-3mm optimal)</LI>
        <LI>Adjust motor speed/acceleration if movements are too fast</LI>
        <LI>Check that Steps/Revolution matches your motor (2048 for 28BYJ-48)</LI>
    </UL>

    <H3>Logging</H3>
    <P>The driver creates detailed logs for troubleshooting:</P>
    <UL>
        <LI><strong>Driver Log:</strong> <code>ASCOM.autoFilterWheel.Driver.xxx</code> - Per-instance driver operations</LI>
        <LI><strong>Hardware Log:</strong> <code>ASCOM.autoFilterWheel.Hardware.xxx</code> - Shared hardware communication</LI>
        <LI><strong>Server Log:</strong> <code>ASCOM.autoFilterWheel.LocalServer.xxx</code> - Local server operations</LI>
    </UL>
    <P>Logs are located in: <code>Documents\ASCOM\Logs yyyy-mm-dd\</code></P>

    <H2>Technical Specifications</H2>
    <TABLE>
        <TR>
            <TH>Specification</TH>
            <TH>Value</TH>
        </TR>
        <TR>
            <TD>ASCOM Interface Version</TD>
            <TD>IFilterWheelV2</TD>
        </TR>
        <TR>
            <TD>Communication Protocol</TD>
            <TD>Serial (USB CDC) at 115200 baud</TD>
        </TR>
        <TR>
            <TD>Supported Filter Positions</TD>
            <TD>3 to 9 configurable positions</TD>
        </TR>
        <TR>
            <TD>Position Accuracy</TD>
            <TD>±1 step (±0.18°) with encoder feedback</TD>
        </TR>
        <TR>
            <TD>Movement Timeout</TD>
            <TD>10 seconds</TD>
        </TR>
        <TR>
            <TD>Firmware Version</TD>
            <TD>2.0+</TD>
        </TR>
    </TABLE>

    <H2>Support and Development</H2>
    <P>
        <strong>Firmware Source Code:</strong> <a href="https://github.com/juanjol/autoFilterWheel" target="_blank">https://github.com/juanjol/autoFilterWheel</a><br/>
        <strong>ASCOM Standards:</strong> <a href="https://ascom-standards.org/" target="_blank">https://ascom-standards.org/</a><br/>
        <strong>ASCOM Developer Forum:</strong> <a href="https://ascomtalk.groups.io/g/Developer" target="_blank">https://ascomtalk.groups.io/g/Developer</a>
    </P>

    <H2>License</H2>
    <P>
        This ASCOM driver is provided free of charge and is open for modification and redistribution under the ASCOM license terms.
        The firmware is available under open-source license at the GitHub repository.
    </P>

    <H2>Credits</H2>
    <P>
        Developed using the ASCOM Platform and Local Server template.<br/>
        Firmware built with PlatformIO and Arduino framework for ESP32-C3.<br/>
        Special thanks to the ASCOM Initiative and community for their excellent standards and support.
    </P>

    <HR/>
    <P STYLE="text-align: center; font-size: 0.9em; color: #666;">
        <em>Last updated: 2025 | ASCOM autoFilterWheel Driver v2.0</em>
    </P>

</BODY>
</HTML>
